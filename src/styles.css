/* ===============================
   knurl
   =============================== */

.knurl-container {
  position: fixed;
  top: 0;
  right: 0;
}

.knurl {
  /* === tokens === */

  /* colors */
  --panel-bg: hsl(230 7% 10%);
  --panel-fg: hsl(230 10% 75%);
  --panel-border: hsl(230 9% 18%);
  --panel-hover: hsl(230 9% 26%);
  --panel-pressed: hsl(230 7% 16%);
  --panel-low-emphasis: hsl(230 4% 55%);
  --panel-focus: var(--panel-fg);
  --panel-selection-fg: var(--panel-bg);
  --panel-selection-bg: var(--panel-fg);

  /* semantic colors */
  --value-number: hsl(220 80% 65%);
  --value-string: hsl(139 45% 56%);

  /* spacing and layout */
  --panel-space: 4px;
  --panel-radius: 2px;
  --panel-width: 256px;
  --label-width: 80px;
  --row-height: 20px;

  /* typography */
  --font-ui: system-ui, -apple-system, sans-serif;
  --font-value: ui-monospace, monospace;
  --font-size-normal: 11px;
  --line-height-normal: 1.4;
  --color-link: var(--value-number);

  /* motion */
  --panel-tween-func: cubic-bezier(0.25, 0.8, 0.5, 1);
  --panel-tween-duration: 200ms;

  /* controls */
  --checkbox-check-width: 3px;
  --checkbox-check-height: 9px;

  /* === base === */
  width: var(--panel-width);
  color: var(--panel-fg);
  font-family: var(--font-ui);
  font-size: var(--font-size-normal);
  line-height: var(--line-height-normal);
  box-sizing: border-box;
  font-variant-numeric: tabular-nums;
}

/* === layout === */

/* rows */
.knurl .knurl-row {
  display: flex;
  flex-direction: row;
  gap: var(--panel-space);
  padding: var(--panel-space) var(--panel-space);
}

/* reduce spacing between adjacent rows */
.knurl .knurl-row + .knurl-row {
  padding-top: calc(var(--panel-space) * 0.5);
}

.knurl .knurl-row:has(+ .knurl-row) {
  padding-bottom: calc(var(--panel-space) * 0.5);
}

.knurl .knurl-group-container .knurl-group-container {
  border-bottom: 1px solid var(--panel-border);
}

.knurl .knurl-row .knurl-label {
  display: flex;
  align-self: flex-start;
  align-items: center;
  line-height: 1.2;
  min-height: 20px;
  min-width: 0;
  user-select: none;
  color: var(--panel-low-emphasis);
  flex: 0 0 var(--label-width);
}

/* groups */
.knurl .knurl-group {
  display: flex;
  flex-direction: column;
  background: var(--panel-bg);
  border-radius: var(--panel-radius);
}

.knurl-container > .knurl > .knurl-group > .knurl-label {
  border-radius: 0 0 var(--panel-radius) var(--panel-radius);
}

.knurl .knurl-group > .knurl-label {
  display: flex;
  align-items: center;
  user-select: none;
  background: var(--panel-border);
  border-radius: var(--panel-radius);
  height: var(--row-height);
  padding-left: var(--panel-space);
  gap: var(--panel-space);
}

/* group with expander */
.knurl .knurl-group > .knurl-label:has(> .knurl-icon) {
  cursor: pointer;
}

.knurl .knurl-group > .knurl-label > .knurl-icon {
  font-weight: bold;
  font-size: 10px;
  cursor: pointer;
}

/* animated expand/collapse - respect motion preferences */
@media (prefers-reduced-motion: no-preference) {
  .knurl .knurl-group > .knurl-label > .knurl-icon {
    transition: transform var(--panel-tween-duration) var(--panel-tween-func);
  }
}

.knurl .knurl-group.knurl-expanded > .knurl-label > .knurl-icon {
  transform: rotate(180deg);
}

/* basic expand/collapse */
.knurl .knurl-group > .knurl-group-container {
  flex-direction: column;
  overflow: hidden;
  display: none;
}

.knurl .knurl-group.knurl-expanded > .knurl-group-container {
  display: flex;
}

/* browsers with allow-keywords (chrome 115+): smooth animation */
@supports (interpolate-size: allow-keywords) {
  .knurl .knurl-group > .knurl-group-container {
    display: flex;
    interpolate-size: allow-keywords;
    height: 0;
    opacity: 0;
  }

  @media (prefers-reduced-motion: no-preference) {
    .knurl .knurl-group > .knurl-group-container {
      transition:
        height var(--panel-tween-duration) var(--panel-tween-func),
        padding var(--panel-tween-duration) var(--panel-tween-func),
        opacity var(--panel-tween-duration) var(--panel-tween-func);
    }
  }

  .knurl .knurl-group.knurl-expanded > .knurl-group-container {
    height: auto;
    opacity: 1;
  }
}

/* panel container styling */
.knurl-container > .knurl {
  border-radius: 0 0 var(--panel-radius) var(--panel-radius);
}

/* === form controls === */

.knurl .knurl-row .knurl-control {
  flex: 1 1 auto;
  display: flex;
  justify-content: flex-start;
  align-items: center;
  min-height: var(--row-height);
  gap: var(--panel-space);
}

/* base input styles */
.knurl button,
.knurl input,
.knurl select,
.knurl textarea {
  font-size: inherit;
  font-family: inherit;
  width: 100%;
  box-sizing: border-box;
  border: 1px solid transparent;
  padding: 0 var(--panel-space);
  border-radius: var(--panel-radius);
  background: var(--panel-border);
  color: var(--panel-fg);
}

.knurl button,
.knurl select,
.knurl input[type="text"],
.knurl input[type="range"] {
  min-height: var(--row-height);
}

.knurl input[type="color"] {
  height: var(--row-height);
}

/* cursor states */
.knurl button,
.knurl select,
.knurl input[type="checkbox"],
.knurl input[type="range"],
.knurl input[type="color"] {
  cursor: pointer;
}

.knurl input[type="text"],
.knurl textarea {
  cursor: text;
}

/* focus states */
.knurl button:focus-visible,
.knurl select:focus-visible,
.knurl input:focus-visible,
.knurl textarea:focus-visible {
  outline: 2px solid var(--panel-focus);
  outline-offset: 0px;
}

/* remove default focus for mouse users */
.knurl button:focus:not(:focus-visible),
.knurl select:focus:not(:focus-visible),
.knurl input:focus:not(:focus-visible),
.knurl textarea:focus:not(:focus-visible) {
  outline: none;
}

/* hover states */
.knurl button:hover:not(:active):not(.knurl-selected),
.knurl input:hover,
.knurl select:hover,
.knurl textarea:hover {
  background: var(--panel-hover);
}

/* active/selected states */
.knurl button:active,
.knurl button.knurl-selected {
  background: var(--panel-fg);
  color: var(--panel-bg);
  border-radius: var(--panel-radius);
}

/* selection */
.knurl input::selection,
.knurl textarea::selection {
  background: var(--panel-selection-bg);
  color: var(--panel-selection-fg);
}

.knurl textarea {
  resize: vertical;
  min-height: calc(var(--row-height) * 2 + var(--panel-space));
  line-height: var(--line-height-normal);
  color: var(--value-string);
  font-family: var(--font-value);
}

/* === specific controls === */

/* toggle group */
.knurl .knurl-buttons {
  display: flex;
  flex-direction: row;
  flex: 1;
  gap: var(--panel-space);
}

/* vector 2d */
.knurl .knurl-pad2 {
  position: absolute;
  align-self: flex-start;
  margin-top: calc(var(--row-height) + var(--panel-space));
  width: calc(var(--panel-width) - var(--label-width) - 2 * var(--panel-space));
  height: calc(
    var(--panel-width) - var(--label-width) - 2 * var(--panel-space)
  );
  background: var(--panel-bg);
  z-index: 1001;
}

.knurl .knurl-pad2 .knurl-border {
  stroke: var(--panel-fg);
  stroke-opacity: 0.25;
}

.knurl .knurl-pad2 .knurl-grid {
  stroke: var(--panel-fg);
  stroke-opacity: 0.25;
}

.knurl .knurl-pad2 .knurl-label {
  fill: var(--panel-fg);
  opacity: 0.5;
}

.knurl .knurl-pad2 .knurl-indicator {
  fill: var(--panel-fg);
}

.knurl button.knurl-translate {
  font-weight: bolder;
}

.knurl button.knurl-translate.knurl-selected {
  cursor: grabbing;
}

/* text input */
.knurl input[type="text"] {
  color: var(--value-string);
  font-family: var(--font-value);
}

/* number input  */
.knurl input[type="text"].knurl-number-input {
  color: var(--value-number);
}

/* number input: remove spinners */
.knurl input[type="number"]::-webkit-inner-spin-button,
.knurl input[type="number"]::-webkit-outer-spin-button {
  appearance: none;
  margin: 0;
}

.knurl input[type="text"].knurl-fixed {
  width: 60px;
}

/* display */
.knurl .knurl-control > .knurl-display {
  line-height: var(--row-height);
}

.knurl .knurl-control > .knurl-display.knurl-monospace {
  font-family: var(--font-value);
}

.knurl .knurl-display a {
  color: var(--color-link);
  text-decoration: underline;
}

.knurl .knurl-display a:hover {
  text-decoration: none;
}

.knurl pre.knurl-display {
  margin: 0;
}

/* checkbox */
.knurl input[type="checkbox"] {
  margin: 0;
  appearance: none;
  border-radius: var(--panel-radius);
  width: 14px;
  height: 14px;
  text-align: center;
}

.knurl input[type="checkbox"]:checked:before {
  content: "";
  display: flex;
  height: var(--checkbox-check-height);
  width: var(--checkbox-check-width);
  border-bottom: 2px solid var(--panel-fg);
  border-right: 2px solid var(--panel-fg);
  transform: rotate(45deg);
}

/* range input */
.knurl input[type="range"] {
  -webkit-appearance: none;
  appearance: none;
  background: transparent;
  margin: 0;
  padding: 0;
}

/* range input: track */
.knurl input[type="range"]::-webkit-slider-runnable-track {
  background: var(--panel-border);
  height: 3px;
  border-radius: 2px;
  margin: 0 -1px; /* align with text input */
}

.knurl input[type="range"]::-moz-range-track {
  background: var(--panel-border);
  height: 3px;
  border-radius: 2px;
  margin: 0 -1px;
}

/* range input: thumb */
.knurl input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 12px;
  height: 12px;
  border-radius: var(--panel-radius);
  background: var(--panel-fg);
  margin-top: -4px;
}

.knurl input[type="range"]::-moz-range-thumb {
  width: 12px;
  height: 12px;
  border-radius: var(--panel-radius);
  background: var(--panel-fg);
  border: none;
}

/* color input */
.knurl input[type="color"] {
  -webkit-appearance: none;
  border: 1px solid var(--panel-border);
  padding: 0;
  border-radius: var(--panel-radius);
  height: var(--row-height);
}

.knurl input[type="color"]::-webkit-color-swatch-wrapper {
  padding: 0;
}

.knurl input[type="color"]::-webkit-color-swatch {
  border: 0;
}

/* number-monitor */
.knurl canvas.knurl-graph {
  width: 100%;
}
